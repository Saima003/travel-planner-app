const {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } = require("@google/generative-ai");
  
  const apiKey = process.env.EXPO_PUBLIC_GEMINI_KEY;

  const genAI = new GoogleGenerativeAI(apiKey);
  
  const model = genAI.getGenerativeModel({
    model: "gemini-2.0-flash-exp",
  });
  
  const generationConfig = {
    temperature: 1,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseMimeType: "application/json",
  };
  
   export const chatSession = model.startChat({
      generationConfig,
      history: [
        {
          role: "user",
          parts: [
            {text: "Generate travel plan for location: Mumbai, Maharashtra, India, for 3 day and 2 night for Just Me with a Cheap budget with a flight details. approx estimations of flight price with booking url of any website like bookmyticket etc. Hotels options list with hotel name, hotel address, price and hotel image urls. geo coordinates, rating, descriptions and places to visit nearby with place name, place details , place image url, geo coordinates, ticket pricing, time to travel each of the location for 3 day and 2 night with each day plan with best time to visit in JSON format\n"},
          ],
        },
        {
          role: "model",
          parts: [
            {text: "Okay, here's a detailed 3-day, 2-night budget travel plan for Mumbai, designed for a solo traveler, presented in JSON format.\n\n```json\n{\n  \"trip_details\": {\n    \"location\": \"Mumbai, Maharashtra, India\",\n    \"duration\": \"3 Days, 2 Nights\",\n    \"traveler_type\": \"Solo\",\n    \"budget\": \"Cheap/Budget\",\n      \"currency\": \"INR\",\n    \"approx_flight_estimation\": {\n        \"source\": \"Your Departure City\",\n        \"destination\": \"Mumbai (BOM)\",\n        \"approx_price\": \"₹5,000 - ₹8,000 (Round Trip, Subject to Change)\",\n        \"booking_url\": \"https://www.makemytrip.com/flights/\",\n         \"note\":\"Flight prices vary depending on departure city, time of booking, and season. Book in advance for better deals. Please search for your own city for the estimated price.\"\n\n    }\n  },\n  \"hotel_options\": [\n    {\n      \"hotel_name\": \"Hotel City Palace\",\n      \"address\": \"Near Mumbai Central Station, Mumbai\",\n      \"price_per_night\": \"₹1200-₹1800\",\n      \"image_url\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/15/1f/05/aa/hotel-city-palace.jpg?w=700&h=500&s=1\",\n      \"geo_coordinates\": {\n        \"latitude\": 18.9678,\n        \"longitude\": 72.8316\n      },\n        \"rating\": \"3.5/5\",\n         \"description\": \"A basic and budget-friendly option, close to the railway station, offering easy access to local transport. Good for solo travelers needing a place to crash.\",\n        \"amenities\" : [\"Free Wifi\",\"Attached Bathroom\",\"Air Conditioning\"]\n    },\n    {\n      \"hotel_name\": \"Backpacker Panda Colaba\",\n      \"address\": \"Colaba Causeway, Colaba, Mumbai\",\n      \"price_per_night\": \"₹1000-₹1500\",\n      \"image_url\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/19/8a/59/c7/backpacker-panda-colaba.jpg?w=700&h=500&s=1\",\n      \"geo_coordinates\": {\n        \"latitude\": 18.9155,\n        \"longitude\": 72.8339\n      },\n        \"rating\": \"4.0/5\",\n         \"description\": \"A popular hostel option in the vibrant Colaba area, great for social interaction and budget-conscious travelers. Dorms and private rooms available.\",\n        \"amenities\": [\"Free Wifi\", \"Dormitory and private rooms available\", \"Common room\"]\n\n    },\n     {\n      \"hotel_name\": \"Hotel Al Madina\",\n      \"address\": \"Near Crawford Market, Mumbai\",\n      \"price_per_night\": \"₹1000-₹1500\",\n      \"image_url\": \"https://content.jdmagicbox.com/comp/mumbai/e2/022pxx22.xx22.110324171353.g5e2/catalogue/hotel-al-madina-mumbai-hotels-d70v6.jpg\",\n      \"geo_coordinates\": {\n        \"latitude\": 18.9477,\n        \"longitude\": 72.8348\n      },\n        \"rating\": \"3.0/5\",\n         \"description\": \"Simple, affordable option near Crawford market. Basic amenities and good connectivity to the city\",\n           \"amenities\": [\"Attached Bathroom\", \"Air Conditioning\",\"Room Service\"]\n    }\n  ],\n   \"itinerary\": {\n    \"day_1\": {\n      \"theme\": \"South Mumbai Exploration\",\n        \"best_time_to_visit\": \"October to March(Pleasant Weather)\",\n      \"plan\": [\n        {\n          \"place_name\": \"Gateway of India\",\n          \"place_details\": \"Iconic arch monument overlooking the Arabian Sea. A must-visit symbol of Mumbai. Take a ferry to Elephanta Caves from here\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Gateway_of_India_Mumbai.jpg/1280px-Gateway_of_India_Mumbai.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9220,\n            \"longitude\": 72.8347\n          },\n          \"ticket_pricing\": \"Free (Ferry to Elephanta: ~₹200)\",\n          \"travel_time_from_hotel\": \"30-45 minutes by taxi/local train from most hotels listed above\",\n         \"best_time_to_visit_here\" : \"Early morning or late evening for pleasant weather and fewer crowds.\"\n        },\n        {\n          \"place_name\": \"Chhatrapati Shivaji Maharaj Terminus (CST)\",\n          \"place_details\": \"A UNESCO World Heritage Site, a grand railway station with stunning architecture. A marvel for architectural enthusiasts.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/CST_Mumbai_%28Night_View%29.jpg/1280px-CST_Mumbai_%28Night_View%29.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9405,\n            \"longitude\": 72.8338\n          },\n          \"ticket_pricing\": \"Free\",\n          \"travel_time_from_gateway_of_india\": \"15-20 minutes by taxi/local train\",\n           \"best_time_to_visit_here\" : \"Any time. But night view is beautiful\"\n        },\n        {\n          \"place_name\": \"Marine Drive\",\n          \"place_details\": \"A scenic promenade along the coast, popular for evening walks and sunset views. Known as 'Queen's Necklace'.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Marine_Drive_Mumbai.jpg/1280px-Marine_Drive_Mumbai.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9448,\n            \"longitude\": 72.8200\n          },\n          \"ticket_pricing\": \"Free\",\n          \"travel_time_from_cst\": \"15-20 minutes by taxi\",\n           \"best_time_to_visit_here\" : \"Late afternoon and evening.\"\n\n        },\n           {\n          \"place_name\": \"Street Food at Girgaum Chowpatty\",\n          \"place_details\": \"Enjoy cheap and delicious Mumbai street food like vada pav, pav bhaji, and pani puri at this popular beach\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Mumbai_street_food.jpg/1280px-Mumbai_street_food.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9545,\n            \"longitude\": 72.8177\n          },\n          \"ticket_pricing\": \"₹100-₹200 (approx per person)\",\n          \"travel_time_from_marine_drive\": \"5-10 minutes by walk\",\n           \"best_time_to_visit_here\" : \"Evening\"\n\n        }\n      ]\n    },\n    \"day_2\": {\n      \"theme\": \"Caves, Markets and Spiritual\",\n         \"best_time_to_visit\": \"October to March(Pleasant Weather)\",\n      \"plan\": [\n        {\n          \"place_name\": \"Elephanta Caves\",\n          \"place_details\": \"Ancient rock-cut caves on an island, a UNESCO World Heritage Site. Famous for its intricate carvings and sculptures dedicated to Lord Shiva.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Trimurti_at_Elephanta.jpg/1280px-Trimurti_at_Elephanta.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9657,\n            \"longitude\": 72.9301\n          },\n          \"ticket_pricing\": \"₹40 for Indians, ₹600 for Foreigners (Ferry to Elephanta from Gateway of India is separate)\",\n          \"travel_time_from_hotel\": \"1.5 to 2 hours (including ferry ride from Gateway of India) \",\n           \"best_time_to_visit_here\" : \"Early morning to avoid crowds and heat.\"\n        },\n        {\n          \"place_name\": \"Crawford Market\",\n          \"place_details\": \"A vibrant market, perfect for shopping and experiencing the local Mumbai atmosphere. Good place to buy snacks and spices.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Crawford_Market_Mumbai.JPG/1280px-Crawford_Market_Mumbai.JPG\",\n          \"geo_coordinates\": {\n            \"latitude\": 18.9472,\n            \"longitude\": 72.8342\n          },\n          \"ticket_pricing\": \"Free\",\n           \"travel_time_from_elephanta_caves\": \"1 to 1.5 hours (Including ferry back to gateway of India and taxi)\",\n            \"best_time_to_visit_here\" : \"Late morning to afternoon.\"\n        },\n          {\n          \"place_name\": \"Shree Siddhivinayak Temple\",\n          \"place_details\": \"A popular and famous temple dedicated to Lord Ganesha.  A must visit for those seeking spiritual solace.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Siddhivinayak_Temple_Mumbai.jpg/1280px-Siddhivinayak_Temple_Mumbai.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 19.0227,\n            \"longitude\": 72.8342\n          },\n          \"ticket_pricing\": \"Free\",\n            \"travel_time_from_crawford_market\": \"30 to 45 minutes by taxi/local train\",\n           \"best_time_to_visit_here\" : \"Any time except for aarti hours, but early morning to avoid long queues\"\n        }\n      ]\n    },\n     \"day_3\": {\n      \"theme\": \"Local culture and Departure\",\n       \"best_time_to_visit\": \"October to March(Pleasant Weather)\",\n      \"plan\": [\n       {\n          \"place_name\": \"Dharavi Slum\",\n          \"place_details\": \"A guided walk through one of Asia's largest slums. An eye opening experience showcasing the entrepreneurship and community of dharavi.\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Dharavi_slum.jpg/1280px-Dharavi_slum.jpg\",\n          \"geo_coordinates\": {\n            \"latitude\": 19.0453,\n            \"longitude\": 72.8618\n          },\n          \"ticket_pricing\": \"₹800-₹1500 (guided tour)\",\n            \"travel_time_from_siddhivinayak_temple\": \"15 to 20 minutes by taxi\",\n            \"best_time_to_visit_here\" : \"Morning before the heat sets in.\"\n         },\n         {\n            \"place_name\": \"Juhu Beach\",\n            \"place_details\": \"A popular beach in Mumbai, known for its street food and leisure activities. Good place to relax before your flight.\",\n            \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Juhu_Beach_Mumbai_India.jpg/1280px-Juhu_Beach_Mumbai_India.jpg\",\n            \"geo_coordinates\": {\n             \"latitude\": 19.0910,\n              \"longitude\": 72.8242\n            },\n            \"ticket_pricing\": \"Free\",\n              \"travel_time_from_dharavi\": \"30 to 45 minutes by taxi\",\n            \"best_time_to_visit_here\" : \"Late afternoon and evening\"\n         },\n          {\n          \"place_name\": \"Mumbai Airport(BOM)\",\n           \"place_details\": \"Head to airport for departure\",\n          \"image_url\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/f/fd/Mumbai_Airport_Terminal_2_Entrance.jpg/1280px-Mumbai_Airport_Terminal_2_Entrance.jpg\",\n          \"geo_coordinates\": {\n             \"latitude\": 19.0954,\n            \"longitude\": 72.8689\n          },\n          \"ticket_pricing\": \"Free\",\n            \"travel_time_from_juhu_beach\": \"15-30 minutes depending on traffic\",\n              \"best_time_to_visit_here\" : \"As per your flight timings\"\n        }\n\n      ]\n    }\n  },\n\n  \"notes\": [\n    \"Use local transport like local trains and BEST buses for cost-effective commuting.\",\n    \"Bargain while shopping in markets and with auto-rickshaw drivers.\",\n    \"Try street food, but be cautious of hygiene.\",\n    \"Carry a water bottle and refill it at safe places.\",\n    \"Respect local customs and traditions while visiting temples or religious sites.\",\n      \"Download a local transport app like M-Indicator for real-time updates on local trains and buses.\",\n     \"Be aware of pickpockets in crowded places.\",\n    \"Always keep some cash handy.\"\n\n  ]\n}\n```\n**Explanation:**\n\n*   **`trip_details`**: Contains overall information about the trip.\n*   **`hotel_options`**: Lists budget-friendly hotels with details.\n*   **`itinerary`**:  Breaks down the 3 days with a theme for each day, a detailed list of the places to visit, along with descriptions, geo-coordinates, ticket prices, travel time between locations and best time to visit the place.\n*   **`notes`**: Provides helpful tips for budget travelers.\n\n**Key Budget Tips**\n*   **Accommodation:** Hostels and budget guesthouses are much more affordable than hotels.\n*   **Transportation:** Use the Mumbai local trains and buses for cheaper travel. Uber/Ola can be used for quicker travel but may add to your budget.\n*   **Food:**  Enjoy the famous street food of Mumbai - it's delicious and very budget-friendly.\n*   **Free activities:** Many attractions, like Marine Drive and Juhu Beach, are free to enjoy.\n\nThis plan is designed to be flexible; you can adjust it based on your interests and energy levels. Have a fantastic trip to Mumbai!\n"},
          ],
        },
      ],
    });
  

  